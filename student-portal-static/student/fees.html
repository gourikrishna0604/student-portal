<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fee Payment - Student</title>
    <link rel="stylesheet" href="../assets/styles.css">
</head>

<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>ðŸŽ“ Student Portal</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html">Dashboard</a>
                <a href="view-attendance.html">My Attendance</a>
                <a href="timetable.html">Timetable</a>
                <a href="results.html">Results</a>
                <a href="fees.html" class="active">Fees</a>
                <a href="#" onclick="Auth.logout()">Logout</a>
            </nav>
        </aside>

        <main class="main-content">
            <h2>Tuition Fees</h2>

            <div class="grid grid-3">
                <div class="card">
                    <h3>Total Fee</h3>
                    <p id="total" style="font-size: 1.5rem;">â‚¹0</p>
                </div>
                <div class="card">
                    <h3>Paid Amount</h3>
                    <p id="paid" style="font-size: 1.5rem; color: var(--success);">â‚¹0</p>
                </div>
                <div class="card">
                    <h3>Due Amount</h3>
                    <p id="due" style="font-size: 1.5rem; color: var(--danger);">â‚¹0</p>
                </div>
            </div>

            <div class="card mt-4" id="paySection">
                <h3>Make Payment</h3>
                <p>Enter amount to pay:</p>
                <div class="flex items-center mt-4">
                    <input type="number" id="amount" class="form-control" style="max-width: 200px; margin-right: 10px;"
                        placeholder="Amount">
                    <button class="btn" onclick="payFees()">Pay Now</button>
                </div>
            </div>
        </main>
    </div>

    <script src="../assets/script.js"></script>
    <script>
        const user = Auth.requireRole('student');
        const db = DB.get();
        const studentIndex = db.students.findIndex(s => s.id === user.studentId);
        const student = db.students[studentIndex];

        if (student && student.fees) {
            document.getElementById('total').textContent = 'â‚¹' + student.fees.total;
            document.getElementById('paid').textContent = 'â‚¹' + student.fees.paid;
            document.getElementById('due').textContent = 'â‚¹' + student.fees.due;

            if (student.fees.due <= 0) {
                document.getElementById('paySection').innerHTML = '<h3>Fees Fully Paid! ðŸŽ‰</h3>';
            }
        }

        function payFees() {
            const amount = parseInt(document.getElementById('amount').value);
            if (!amount || amount <= 0) { alert('Invalid amount'); return; }
            if (amount > student.fees.due) { alert('Amount exceeds due balance'); return; }

            // Update DB
            const currentDb = DB.get();
            const s = currentDb.students[studentIndex];

            s.fees.paid += amount;
            s.fees.due -= amount;

            DB.save(currentDb);
            alert('Payment Successful!');
            location.reload();
        }
    </script>
</body>

</html>